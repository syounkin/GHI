Foo.
```{r states, eval = TRUE, echo = TRUE, results = "show", warning = TRUE, error = TRUE, message = TRUE}

library(devtools)
install_github("syounkin/ITHIM", ref="devel", force=TRUE)
library("ITHIM")
library("tidyr")
packageVersion("ITHIM")
rm(list=ls())

states <- readRDS("~/GHI/R/data/ITHIMList.by.state.rds")

allStatesResults <- data.frame()

n <- 5 # length of walk and cycle vectors
ntVec <- c(2, 5, 10) # must be ordered and have length 3

stateVec <- names(states)

for(state in stateVec){

    results <- data.frame()

    base <- states[[state]]
    base <- update(base, list(quantiles = seq(0.1, 0.9, by = 0.1)))

    totalDALYs <- data.frame(getBurden(base, dis = "all"),
                    getBurden(base, dis = "BreastCancer"),
                    getBurden(base, dis = "ColonCancer"),
                    getBurden(base, dis = "CVD"),
                    getBurden(base, dis = "Dementia"),
                    getBurden(base, dis = "Depression"),
                    getBurden(base, dis = "Diabetes")
                    )

    names(totalDALYs) <- c("DALY.all","DALY.BreastCancer","DALY.ColonCancer","DALY.CVD","DALY.Dementia","DALY.Depression","DALY.Diabetes")

    baseWalk <- getMeans(base)$walk
    baseCycle <-  getMeans(base)$cycle

    wVec <- baseWalk + seq(0, 60, length.out = n)
    cVec <- baseCycle + seq(0, 60, length.out = n)

    for(muNT in ntVec){
        base <- update(base, list(muNonTravel = muNT))
        for(wlk in wVec){
            for(cyc in cVec){
                scenario <- update(base, list(muwt = wlk, muct = cyc, muNonTravel = muNT))
                activityLevel <- ifelse(muNT == ntVec[1], "Low", ifelse(muNT == ntVec[2], "Medium", ifelse(muNT == ntVec[3], "High", NA)))
                comparativeRisk <- data.frame(ST = state,
                                              cycleTime = getMeans(scenario)$cycle,
                                              walkTime= getMeans(scenario)$walk,
                                              minIncreaseCycle = cyc-baseCycle,
                                              minIncreaseWalk = wlk-baseWalk,
                                              nonTravelActivity = activityLevel, stringsAsFactors = FALSE)

                deltaDALYs <- data.frame(deltaBurden(base, scenario, dis = "all"),
                                         deltaBurden(base, scenario, dis = "BreastCancer"),
                                         deltaBurden(base, scenario, dis = "ColonCancer"),
                                         deltaBurden(base, scenario, dis = "CVD"),
                                         deltaBurden(base, scenario, dis = "Dementia"),
                                         deltaBurden(base, scenario, dis = "Depression"),
                                         deltaBurden(base, scenario, dis = "Diabetes")
                                         )

                deltaDALYs <- data.frame(ifelse(t(unlist(deltaDALYs)) > 0, 0, deltaDALYs))


                names(deltaDALYs) <- c("all","BreastCancer","ColonCancer","CVD","Dementia","Depression","Diabetes")


                foo <- cbind(comparativeRisk, deltaDALYs)

                foo <- foo %>% gather("disease","value",7:13)

                foo <- data.frame(foo, total = t(totalDALYs))

                results <- rbind(foo, results)
            }
        }
    }

    allStatesResults <- rbind(results, allStatesResults)

}

summary(allStatesResults)

allStatesResults <- allStatesResults %>% dplyr::mutate( deltaBurden = -value, pctReduction = -100*value/total)

summary(allStatesResults)

allStatesResults <- melt(allStatesResults[,!names(allStatesResults) %in% c("value","total")], id =c("ST","cycleTime","walkTime","minIncreaseCycle","minIncreaseWalk","nonTravelActivity","disease"))

summary(allStatesResults)

write.csv(allStatesResults, file = "~/GHI/data/stateResults.csv", quote = FALSE, row.names = FALSE)
```
